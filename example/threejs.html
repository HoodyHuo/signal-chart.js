<!DOCTYPE html>
<html>

<head>
    <meta charset='utf-8'>
    <meta http-equiv='X-UA-Compatible' content='IE=edge'>
    <title>Page Title</title>
    <script src="axios.js"></script>
    <style>
        .cont{
            height: 800px;
            width: 1000px;
            background-color: bisque;
        }
    </style>
</head>

<body>
    <div id="cont" class="cont" ></div>
    <script type="module" >
        import {Spectrogram} from '../lib/signal-chart.js'
        const MAX_POINTS  = 6558
        const gram = new Spectrogram({
            keepMode: 3, // 保持模式 0 刷新 1 最大 2 最小 3 平均
            maxPoint: MAX_POINTS,
            cacheCount: 500,
            Performance: true, // 是否打开性能监视窗口
            El: document.getElementById("cont"), // 图形绘制节点 
        })

        gram.line.scale.y = 10
        gram.line.scale.x = 0.7



        // animate
        axios.get('./TFData.data', { responseType: 'arraybuffer' }).then(res => {
                const bitData = res.data
                // 取出1000帧
                const uint8Array = new Int8Array(bitData).slice(0, MAX_POINTS * 100000)
                const float32Arr = Float32Array.from(uint8Array)
                let index = 0
                setInterval(function () {
                    // 根据下标，从总数据包中取出接下来的一段，因为数据包含XYZ，所以长度要取 3倍
                    const data = float32Arr.slice(index, index + MAX_POINTS )
                    gram.update(data)
                    //取数下标更新
                    index += MAX_POINTS
                    // 如果下标超出数据范围，重新移动到0
                    if (index > float32Arr.length) {
                        index = 0
                    }
                }, 1000/60)

            })

    </script>

</body>

</html>